{% extends 'admin/base.html.twig' %}

{% block title %}{{ pageTitle|raw }}{% endblock %}
{% block pageTitle %}{{ pageTitle|raw }}{% endblock %}

{% block content %}

    {% include '_partial/alert.html.twig' with {flashes: app.flashes} only %}

    {% if events|length %}
        <div class="row">
        {% for event in events %}
            <div class="col-12 col-md-6 mb-3">
                <div class="card h-100 shadow position-relative {% if event.type == 'collection' %}border-primary{% endif %}">
                        {% if is_granted('EDIT', event) and collection is not defined %}
                            {% if not event.parent %}
                                {% if event.archivedAt == null %}
                                    <a href="{{ path('event.archive', {id: event.id}) }}" class="btn btn-light btn-sm position-absolute" title="Archiver" style="top:0;right:0;" data-bs-tooltip="true" data-placement="bottom">
                                        <i class="fas fa-archive"></i>
                                        <span class="sr-only">Archiver</span>
                                    </a>
                                {% else %}
                                    <a href="{{ path('event.archive', {id: event.id}) }}" class="btn btn-light btn-sm position-absolute" title="Désarchiver" style="top:0;right:0;" data-bs-tooltip="true" data-placement="bottom">
                                        <i class="fas fa-undo-alt"></i>
                                        <span class="sr-only">Restaurer</span>
                                    </a>
                                {% endif %}
                            {% endif %}
                            {% if  event.type != 'collection' and is_granted('MANAGE_ALL_EVENTS') %}
                                <a href="{{ path('event.move', {id: event.id}) }}" class="btn btn-light btn-sm position-absolute" style="{% if event.parent %}top:0;right:0px;{% else %}top:0;right:35px;{% endif %}" title="Déplacer" data-bs-tooltip="true" data-placement="bottom">
                                    <i class="fas fa-exchange-alt"></i>
                                </a>
                            {% endif %}
                        {% endif %}
                    <div class="card-body d-flex flex-row justify-content-start align-items-center">
                        {% if event.visual %}
                            <a href="{% if event.type != 'collection' %}{{ path('app_event_resume', {id: event}) }}{% else %}{{ path('app_collection', {id: event}) }}{% endif %}" class="d-block bg-cover overflow-hidden rounded-circle shadow me-3 flex-grow-0 flex-shrink-0" style="width:100px;background-image: url({{ vich_uploader_asset(event.visual, 'file')|imagine_filter('thumbnail') }})">
                                <div style="padding-bottom:100%;width:1px;"></div>
                            </a>
                        {% endif %}
                        <div class="flex-shrink-1 flex-grow-1" style="min-width: 0">
                            <a href="{% if event.type != 'collection' %}{{ path('app_event_resume', {id: event}) }}{% else %}{{ path('app_collection', {id: event}) }}{% endif %}" class="d-block fw-bold text-truncate">
                                {% if event.type != 'collection' %}
                                    <i class="far fa-calendar-alt me-1"></i>
                                {% else %}
                                    <span class="badge bg-primary me-1">{{ event.children.count }}</span>
                                {% endif %}
                                {{ event.name }}
                            </a>
                            <div>
                                <span class="d-none d-lg-inline">{{ event.beginAt|format_datetime(pattern="eee", locale="fr") }}</span>
                                {{ event.beginAt|format_datetime(pattern="dd MMM y", locale="fr") }}{#
                                #}<span class="d-none d-lg-inline">, {{ event.beginAt|format_datetime(pattern="H:mm", locale="fr") }}</span>
                            </div>
                            <div class="small text-muted">
                                <span class="d-none d-lg-inline">Propriétaire&nbsp;:</span>
                                {% if event.owner == app.user %}
                                    Moi
                                {% else %}
                                    {{ event.owner.displayName }}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
        </div>
        {% include '_partial/paginator.html.twig' with {paginator: events} only %}
    {% else %}
        <div class="card shadow">
            <div class="card-body">Aucun événement à afficher.</div>
        </div>
    {% endif %}
{% endblock %}